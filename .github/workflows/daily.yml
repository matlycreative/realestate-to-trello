name: Realestate to Trello

on:
  workflow_dispatch:
  schedule:
    - cron: "0 9 * * *" # run daily at 09:00 UTC; adjust as needed

permissions:
  contents: write   # required so the auto-commit action can push

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
      # keep credentials so we can push back to the repo
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests urllib3 "beautifulsoup4>=4.9" tldextract python-dotenv dnspython python-whois || true

      - name: Run script
        env:
          # Trello (required)
          TRELLO_KEY: ${{ secrets.TRELLO_KEY }}
          TRELLO_TOKEN: ${{ secrets.TRELLO_TOKEN }}
          TRELLO_LIST_ID: ${{ secrets.TRELLO_LIST_ID }}
          # Optional: template cloning if you use PRECLONE=1
          TRELLO_TEMPLATE_CARD_ID: ${{ secrets.TRELLO_TEMPLATE_CARD_ID }}
          # Discovery (optional)
          FOURSQUARE_API_KEY: ${{ secrets.FOURSQUARE_API_KEY }}
          # Behavior toggles (optional)
          DAILY_LIMIT: "10"
          PUSH_INTERVAL_S: "60"
          DEBUG: "0"
          # If you want a custom location for the file, override; default is seen_domains.txt
          # SEEN_FILE: "seen_domains.txt"
        run: |
          python realestate_to_trello.py

      - name: Auto-commit seen_domains.txt
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: update seen_domains.txt"
          file_pattern: seen_domains.txt