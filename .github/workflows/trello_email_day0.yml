name: Send Day 0 Email on Trello Move

on:
  repository_dispatch:
    types: [trello_card_moved_day0]   # fired by Trello Butler
  workflow_dispatch:                  # manual test
    inputs:
      card_id:
        description: Trello Card ID
        required: true

permissions:
  contents: read

jobs:
  send:
    runs-on: ubuntu-latest
    env:
      # Trello
      TRELLO_KEY: ${{ secrets.TRELLO_KEY }}
      TRELLO_TOKEN: ${{ secrets.TRELLO_TOKEN }}
      TRELLO_LIST_ID_DAY0: ${{ secrets.TRELLO_LIST_ID_DAY0 }}

      # SMTP
      SMTP_HOST: ${{ secrets.SMTP_HOST }}
      SMTP_PORT: ${{ secrets.SMTP_PORT }}
      SMTP_USER: ${{ secrets.SMTP_USER }}
      SMTP_PASS: ${{ secrets.SMTP_PASS }}
      FROM_EMAIL: ${{ secrets.FROM_EMAIL }}
      REPLY_TO_EMAIL: ${{ secrets.REPLY_TO_EMAIL }}

      # pick card id from repository_dispatch payload or manual input
      CARD_ID: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.card_id || inputs.card_id }}

    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: false

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          python -m pip install requests

      - name: Run sender
        run: |
          python trello_email_day0.py
